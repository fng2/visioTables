Original code by Shishok
migration to VS2015 by fng2
